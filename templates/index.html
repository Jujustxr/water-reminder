<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Reminder</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        @font-face {
            font-family: 'SugarFruit';
            src: url('/static/fonts/Sugar Fruit.otf') format('opentype');
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'SugarFruit', cursive;
            margin: 0;
            padding: 0;
        }

        .hero {
            height: 100vh;
            width: 100vw;
            background: url('/static/waterbackground.png') no-repeat center center;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        @keyframes lampFlicker {
            0%   { opacity: 1; filter: brightness(1) drop-shadow(0 0 10px #ffffff); }
            10%  { opacity: 0.7; filter: brightness(1.2) drop-shadow(0 0 20px #ffffff); }
            20%  { opacity: 0.85; filter: brightness(0.9) drop-shadow(0 0 8px #ffffff); }
            30%  { opacity: 0.6; filter: brightness(1.3) drop-shadow(0 0 25px #ffffff); }
            40%  { opacity: 1; filter: brightness(1) drop-shadow(0 0 10px #ffffff); }
            50%  { opacity: 0.8; filter: brightness(1.15) drop-shadow(0 0 18px #ffffff); }
            60%  { opacity: 1; filter: brightness(1) drop-shadow(0 0 10px #4ec9f5); }
            70%  { opacity: 0.75; filter: brightness(0.95) drop-shadow(0 0 12px #ffffff); }
            80%  { opacity: 1; filter: brightness(1.2) drop-shadow(0 0 22px #ffffff); }
            90%  { opacity: 0.65; filter: brightness(1) drop-shadow(0 0 10px #4ec9f5); }
            100% { opacity: 1; filter: brightness(1) drop-shadow(0 0 10px #4ec9f5); }
        }

        .hero-quote {
            color: #222;
            font-size: 3em;
            text-align: center;
            text-shadow: 0 4px 16px #0005;
            margin-bottom: 0;
            font-family: 'SugarFruit', cursive;
            z-index: 2;
            animation: lampFlicker 2.5s infinite;
        }

        .reminder-section {
            min-height: 100vh;
            background: #4ec9f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 40px;
        }

        .reminder-title {
            color: #fff;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 0 4px 16px #0005, 0 0 20px #fff;
            letter-spacing: 2px;
            text-align: center;
        }

        .reminder-content {
            display: flex;
            gap: 40px;
            width: 90vw;
            max-width: 1300px;
            justify-content: center;
            align-items: stretch;
        }

        .reminder-form-box, .reminder-list-box {
            background: #273c5c;
            border-radius: 36px;
            padding: 40px 30px;
            box-sizing: border-box;
            box-shadow: 0 4px 16px #0003;
            width: 100%;
            max-width: 500px;
            min-width: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            min-height: 600px;
        }

        .reminder-form-box form {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .reminder-label {
            color: #fff;
            font-size: 1.5em;
            text-align: center;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        .reminder-input, .reminder-select, .reminder-file {
            width: 100%;
            padding: 12px 24px;
            border-radius: 30px;
            border: none;
            font-family: 'SugarFruit', cursive;
            font-size: 1.2em;
            margin-bottom: 0;
            background: #fff;
            color: #222;
            box-sizing: border-box;
        }

        .reminder-file {
            color: #bbb;
        }

        .reminder-btn-row {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 10px;
        }

        .reminder-btn {
            background: #b1e3fa;
            color: #222;
            border: none;
            border-radius: 30px;
            padding: 10px 32px;
            font-size: 1.2em;
            font-family: 'SugarFruit', cursive;
            cursor: pointer;
            transition: background 0.2s;
        }

        .reminder-btn:hover {
            background: #4ec9f5;
            color: #fff;
        }

        .reminder-list-box {
             overflow-y: auto;
              height: 100%;
               min-height: 600px;
           }

        .reminder-output {
            background: #fff;
            color: #bbb;
            border-radius: 30px;
            padding: 18px 30px;
            font-size: 1.3em;
            font-family: 'SugarFruit', cursive;
            margin-bottom: 22px;
            text-align: left;
            width: 100%;
            box-sizing: border-box;
            letter-spacing: 2px;
        }

    
        .reminder-list-box::-webkit-scrollbar {
            width: 12px;
        }
        .reminder-list-box::-webkit-scrollbar-thumb {
            background: #6a8bbd;
            border-radius: 8px;
        }
        .reminder-list-box::-webkit-scrollbar-track {
            background: #273c5c;
            border-radius: 8px;
        }

        .reminder-view-section {
            min-height: 90vh;
            background: #4ec9f5;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
        }

        .reminder-view-content {
            display: flex;
            background: #273c5c;
            border-radius: 32px;
            padding: 32px 32px;
            gap: 40px;
            align-items: center;
            width: 90vw;
            max-width: 1100px;
            box-sizing: border-box;
        }

        .reminder-view-output {
            background: #fff;
            border-radius: 28px;
            width: 520px;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            box-shadow: 0 4px 16px #0003;
        }

        .reminder-view-output-text {
            color: #d3d3d3;
            font-size: 3em;
            font-family: 'SugarFruit', cursive;
            letter-spacing: 4px;
        }

        .reminder-view-side {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 400px;
            gap: 24px;
        }

        .reminder-view-btn {
            width: 200px;
            background: #b1e3fa;
            color: #222;
            border: none;
            border-radius: 30px;
            padding: 16px 0;
            font-size: 1.5em;
            font-family: 'SugarFruit', cursive;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s;
            letter-spacing: 2px;
            box-shadow: 0 2px 8px #0002;
        }

        .reminder-view-btn:hover {
            background: #4ec9f5;
            color: #fff;
        }

        .reminder-view-bottom {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-top: 24px;
        }

        .reminder-view-arrow {
            background: #b1e3fa;
            border: none;
            border-radius: 8px;
            font-size: 2.5em;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .reminder-view-arrow:hover {
            background: #4ec9f5;
            color: #fff;
        }

        .reminder-view-logo {
            height: 48px;
            width: auto;
            display: block;
        }

        #customNotification {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

#customNotification.hidden {
    display: none;
}

.notif-box {
    background: #e3f4fc;
    border-radius: 24px;
    padding: 30px;
    text-align: center;
    width: 320px;
    font-family: 'SugarFruit', cursive;
    box-shadow: 0 4px 20px #0004;
}

.notif-logo {
    width: 60px;
    margin-bottom: 10px;
}

.notif-title {
    color: #273c5c;
    font-size: 1.8em;
    margin: 0;
    letter-spacing: 2px;
}

.notif-box hr {
    margin: 10px 0;
    border: none;
    border-top: 2px solid #273c5c;
}

#notifReminderTitle, #notifReminderTime {
    color: #273c5c;
    font-size: 1.2em;
    margin: 6px 0;
}

.notif-btns {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
}

.notif-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 16px;
    font-size: 1em;
    cursor: pointer;
    font-family: 'SugarFruit', cursive;
    width: 45%;
}

.notif-btn.okay {
    background: #b1e3fa;
    color: #273c5c;
}

.notif-btn.moh {
    background: #d3eafd;
    color: #273c5c;
}
.delete-btn {
    background: #ff6b6b;
    border: none;
    color: white;
    font-size: 1em;
    padding: 6px 12px;
    border-radius: 12px;
    cursor: pointer;
    font-family: 'SugarFruit', cursive;
    transition: background 0.2s;
}

.delete-btn:hover {
    background: #ff3b3b;
}

.reminder-output-section {
    width: 100vw;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    background: #4ec9f5;
    padding: 40px 0 80px 0;
}

.reminder-output-box {
    background: #273c5c;
    border-radius: 36px;
    padding: 36px 32px;
    box-shadow: 0 4px 16px #0003;
    width: 420px;
    max-width: 95vw;
    min-width: 280px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.reminder-output-title {
    color: #fff;
    font-size: 2em;
    margin-bottom: 24px;
    font-family: 'SugarFruit', cursive;
    letter-spacing: 2px;
    text-align: center;
}

.reminder-output-item {
    background: #fff;
    color: #273c5c;
    border-radius: 24px;
    padding: 18px 22px;
    font-size: 1.1em;
    font-family: 'SugarFruit', cursive;
    margin-bottom: 18px;
    text-align: left;
    width: 100%;
    box-sizing: border-box;
    letter-spacing: 1px;
    box-shadow: 0 2px 8px #0001;
}
    </style>
</head>
<body>
    <section class="hero">
        <div class="hero-quote">
            “YOUR BODY NEEDS WATER, NOT HIS MIXED SIGNALS.”
        </div>
    </section>

    <!-- Page 2: Form -->
    <section class="reminder-section">
    <div class="reminder-title">ADD YOUR REMINDERS</div>
    <div class="reminder-content">
        <div class="reminder-form-box">
            <form action="/save" method="POST" enctype="multipart/form-data">
                <div>
                    <div class="reminder-label">TITLE</div>
                    <input class="reminder-input" type="text" name="title" required>
                </div>
                <div>
                    <div class="reminder-label">DATE</div>
                    <input class="reminder-input" type="date" name="date" required>
                </div>
                <div>
                    <div class="reminder-label">TIME</div>
                    <input class="reminder-input" type="time" name="time" required>
                </div>
                <div>
                    <div class="reminder-label">REPEAT</div>
                    <select class="reminder-select" name="repeat" required>
                        <option value="Once">Once</option>
                        <option value="Tomorrow">Tomorrow</option>
                        <option value="Everyday">Everyday</option>
                    </select>
                </div>
                <div>
                    <div class="reminder-label">SOUND</div>
                    <input class="reminder-file" type="file" name="sound" accept="audio/mp3" required>
                </div>
                <div class="reminder-btn-row">
                    <button class="reminder-btn" type="submit">SAVE</button>
                    <button class="reminder-btn" type="button">CANCEL</button>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- Page 3: Output -->
<section class="reminder-output-section">
    <div class="reminder-output-box">
        <div class="reminder-output-title">YOUR REMINDERS</div>
        {% for r in reminders %}
        <div class="reminder-output-item" data-index="{{ loop.index0 }}">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>{{ r.title }}</strong><br>
                    {{ r.date }} {{ r.time }}<br>
                    Repeat: {{ r.repeat }}
                </div>
                <form action="/delete/{{ loop.index0 }}" method="POST" style="margin-left: 10px;">
                    <button type="submit" class="delete-btn">✖</button>
                </form>
            </div>
            <audio controls style="margin-top: 10px; width: 100%;">
                <source src="{{ r.sound }}" type="audio/mp3">
            </audio>
        </div>
        {% endfor %}
    </div>
</section>

<div id="customNotification" class="hidden">
    <div class="notif-box">
        <img src="/static/hidrasi.in.png" alt="Logo" class="notif-logo">
        <h2 class="notif-title">HIDRASI.IN</h2>
        <hr>
        <p id="notifReminderTitle">(TITLE REMINDER)</p>
        <p id="notifReminderTime">(JAM REMINDER)</p>
        <div class="notif-btns">
            <button onclick="notifOkay()" class="notif-btn okay">OKAY</button>
            <button onclick="notifMoh()" class="notif-btn moh">MOH</button>
        </div>
    </div>
</div>

<!--------------------------------------- JS NYA DISINI WOK ----------------------------------------->
    <script>
    const reminderData = {{ reminders | tojson | safe }};
    const playedFlags = new Array(reminderData.length).fill(false);
    let currentNotifIdx = null;
    let currentAudio = null;
    let mohTimeout = null;

    function showNotification(idx) {
        const r = reminderData[idx];
        document.getElementById("notifReminderTitle").innerText = r.title;
        document.getElementById("notifReminderTime").innerText = r.time;
        document.getElementById("customNotification").classList.remove("hidden");
        currentNotifIdx = idx;


        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
        }
        currentAudio = new Audio(r.sound);
        currentAudio.play();
    }

    function notifOkay() {
        document.getElementById("customNotification").classList.add("hidden");
        if (currentNotifIdx !== null) playedFlags[currentNotifIdx] = true;
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
            currentAudio = null;
        }
        if (mohTimeout) {
            clearTimeout(mohTimeout);
            mohTimeout = null;
        }
        currentNotifIdx = null;
    }

    function notifMoh() {
        document.getElementById("customNotification").classList.add("hidden");
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
            currentAudio = null;
        }
        if (currentNotifIdx !== null) {
            mohTimeout = setTimeout(() => {
                showNotification(currentNotifIdx);
            }, 5000);
        }
    }

    function checkReminderTime() {
        if (currentNotifIdx !== null) return; 
        const now = new Date();
        const pad = n => n.toString().padStart(2, '0');
        const currentTime = pad(now.getHours()) + ':' + pad(now.getMinutes());
        const currentDate = now.getFullYear() + '-' + pad(now.getMonth() + 1) + '-' + pad(now.getDate());

        reminderData.forEach((r, i) => {
            if (!playedFlags[i] && r.date === currentDate && r.time === currentTime) {
                showNotification(i);
            }
        });
    }

    setInterval(checkReminderTime, 1000);
</script>

</body>
</html>
